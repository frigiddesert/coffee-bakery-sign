<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Village Roaster Display</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800;900&display=swap" />

  <style>
    :root{
      --bg: #2B1712;
      --fg: #F4F1EA;
      --muted: rgba(244,241,234,.82);
      --muted2: rgba(244,241,234,.66);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 100%;
      height: 100%;
      background: var(--bg);
      color: var(--fg);
      overflow: hidden;
      font-family: "Playfair Display", serif;
    }

    .wrap{
      width: 100vw;
      height: 100vh;
      padding: 5vw;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5vw;
    }

    .col{
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .title{
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.05;
      font-size: clamp(44px, 5.2vw, 92px);
      margin-bottom: 2.2vw;
    }

    .current{
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: 1.02;
      font-size: clamp(54px, 6.2vw, 120px);
      margin-bottom: 2.8vw;
      word-break: break-word;
      hyphens: auto;
    }

    .subline{
      font-weight: 600;
      font-size: clamp(18px, 1.7vw, 30px);
      color: var(--muted2);
      margin-top: 1.2vw;
      margin-bottom: 0.8vw;
    }

    .list{
      font-weight: 500;
      font-size: clamp(18px, 1.9vw, 34px);
      color: var(--muted);
      line-height: 1.25;
      word-break: break-word;
    }

    .bake-now-list{
      font-weight: 700;
      font-size: clamp(26px, 2.8vw, 48px);
      line-height: 1.3;
      margin-bottom: 2vw;
    }

    .coming-soon{
      font-weight: 500;
      font-size: clamp(16px, 1.7vw, 30px);
      color: var(--muted2);
      opacity: 0.75;
      line-height: 1.3;
    }

    .roast-previous{
      font-weight: 600;
      font-size: clamp(22px, 2.4vw, 42px);
      color: var(--muted);
      line-height: 1.35;
      margin-top: 2vw;
    }

    .today-box{
      margin-top: auto;
      padding-top: 2.2vw;
    }

    .today-list{
      font-weight: 500;
      font-size: clamp(16px, 1.55vw, 28px);
      color: var(--muted2);
      line-height: 1.25;
      max-height: 28vh;
      overflow: hidden;
      position: relative;
    }

    .scroll-inner{
      display: block;
      will-change: transform;
      animation: scrollUp 35s linear infinite;
    }

    @keyframes scrollUp{
      0%   { transform: translateY(0); }
      100% { transform: translateY(-50%); }
    }

    .today-list.no-scroll .scroll-inner{
      animation: none;
    }

    .divider{
      position: absolute;
      left: 50%;
      top: 5vw;
      bottom: 5vw;
      width: 2px;
      background: rgba(244,241,234,.35);
      transform: translateX(-2.5vw);
      pointer-events: none;
      display: none;
    }

    @media (min-width: 900px){
      .divider{ display: block; }
    }

    @media (max-width: 900px){
      .wrap{
        grid-template-columns: 1fr;
        gap: 6vw;
      }
      .divider{ display: none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="col">
      <div class="title">Roasting Now:</div>
      <div class="current" id="roastCurrent">—</div>

      <div class="roast-previous" id="roastPrevious"></div>
    </div>

    <div class="col">
      <div class="title">Baking Now:</div>
      <div class="bake-now-list" id="bakeNow">—</div>

      <div class="subline">Coming Up Soon:</div>
      <div class="coming-soon" id="bakeSoon">—</div>
    </div>
  </div>

  <div class="divider"></div>

  <script>
    const POLL_SECONDS = Number("{{ state_poll_seconds }}") || 10;

    function esc(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;");
    }

    async function tick(){
      try{
        const r = await fetch("/api/state", { cache: "no-store" });
        const s = await r.json();

        // Roasting
        document.getElementById("roastCurrent").textContent = s.roast_current || "—";

        const prevRoasts = s.roasts_today || [];
        const prevEl = document.getElementById("roastPrevious");
        if (prevRoasts.length > 0) {
          prevEl.innerHTML = prevRoasts.map(esc).map(r => `<div>${r}</div>`).join('');
        } else {
          prevEl.innerHTML = "";
        }

        // Baking - first 3 in bold
        const bakeItems = s.bake_items || [];
        const nowEl = document.getElementById("bakeNow");
        const soonEl = document.getElementById("bakeSoon");

        if (bakeItems.length === 0) {
          nowEl.textContent = "—";
          soonEl.textContent = "—";
        } else {
          const first3 = bakeItems.slice(0, 3).map(esc);
          nowEl.innerHTML = first3.map(item => `<div>${item}</div>`).join('');

          const rest = bakeItems.slice(3).map(esc);
          if (rest.length > 0) {
            soonEl.textContent = rest.join(", ");
          } else {
            soonEl.textContent = "—";
          }
        }
      }catch(_e){
      }
    }

    tick();
    setInterval(tick, Math.max(5, POLL_SECONDS) * 1000);
  </script>
</body>
</html>
